<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé≤ Tambola</title>
    <style>
        :root {
            --bg-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --drawn-bg: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --text-primary: #2d3436;
            --accent: #00b894;
            --shadow: 0 10px 30px rgba(0,0,0,0.2);
            --glow: 0 0 20px rgba(0, 184, 148, 0.6);
            --cell-font: 1.5rem;
            --cell-size: 58px;
            --neon-glow: 0 0 25px #00b894;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Segoe UI', Tahoma, -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        header {
            background: linear-gradient(135deg, rgba(46,52,68,0.95), rgba(74,75,82,0.95));
            color: white;
            padding: 1.2rem 2rem;
            text-align: center;
            font-size: 1.6rem;
            font-weight: 700;
            box-shadow: var(--shadow);
            letter-spacing: 1px;
            backdrop-filter: blur(20px);
        }

        .layout {
            display: grid;
            grid-template-columns: 280px 1fr 280px;
            gap: 1.5rem;
            padding: 2rem;
            max-width: 1500px;
            margin: 0 auto;
        }

        @media (max-width: 1300px) { .layout { grid-template-columns: 1fr; } }

        .sidebar { 
            display: flex; 
            flex-direction: column; 
            gap: 1rem; 
        }

        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.25);
        }

        #latest {
            font-size: clamp(4rem, 10vw, 7rem);
            font-weight: 900;
            text-align: center;
            padding: 2rem 1.5rem;
            background: linear-gradient(135deg, #00b894, #00cec9, #55a3ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: -1.5rem -1.5rem 1.5rem;
            border-radius: 20px 20px 0 0;
            text-shadow: var(--neon-glow);
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }

        @keyframes celebrate {
            0% { 
                transform: scale(1) rotate(0deg); 
                box-shadow: 0 0 0 rgba(0,184,148,0);
            }
            50% { 
                transform: scale(1.3) rotate(180deg); 
                box-shadow: 0 0 40px rgba(0,184,148,0.8);
            }
            100% { 
                transform: scale(1.1) rotate(360deg); 
                box-shadow: 0 0 20px rgba(0,184,148,0.4);
            }
        }

        .btn {
            width: 100%;
            padding: 1.1rem 1.5rem;
            border: none;
            border-radius: 15px;
            background: linear-gradient(135deg, var(--accent), #00a085);
            color: white;
            cursor: pointer;
            font-weight: 700;
            font-size: 1.1rem;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            margin-bottom: 0.8rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(0,184,148,0.3);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.6s;
        }

        .btn:hover::before { left: 100%; }
        .btn:hover { 
            transform: translateY(-4px) scale(1.02); 
            box-shadow: 0 12px 30px rgba(0,184,148,0.5);
        }

        .btn:active { transform: translateY(-2px); }

        .btn.danger {
            background: linear-gradient(135deg, #e17055, #d63031);
            box-shadow: 0 6px 20px rgba(225,112,85,0.4);
        }

        label {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.6rem;
            display: block;
            color: var(--text-primary);
        }

        select, input[type="range"], input[type="number"] {
            width: 100%;
            padding: 1rem;
            border-radius: 12px;
            border: 2px solid rgba(0,184,148,0.2);
            background: rgba(255,255,255,0.9);
            font-size: 1rem;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: var(--glow);
        }

        .grid-card { padding: 1.5rem; }
        #grid {
            display: grid;
            grid-template-columns: repeat(15, 1fr);
            grid-template-rows: repeat(6, 1fr);
            gap: 0.6rem;
            padding: 1.5rem;
            max-height: 80vh;
        }

        .cell {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 16px;
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.9));
            font-weight: 900;
            font-size: var(--cell-font);
            cursor: pointer;
            border: 3px solid transparent;
            height: var(--cell-size);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
            overflow: hidden;
        }

        .cell::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(0,184,148,0.3), transparent);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.6s;
        }

        .cell:hover::before {
            width: 300%;
            height: 300%;
        }

        .cell:hover {
            background: linear-gradient(135deg, rgba(0,184,148,0.2), rgba(0,184,148,0.1));
            border-color: var(--accent);
            transform: scale(1.12) translateY(-4px);
            box-shadow: 0 15px 35px rgba(0,184,148,0.4), var(--neon-glow);
        }

        .cell.drawn {
            background: var(--drawn-bg) !important;
            color: white !important;
            transform: scale(1.15) !important;
            border-color: rgba(255,255,255,0.9) !important;
            box-shadow: 0 0 35px rgba(240,147,251,0.8), 0 0 0 8px rgba(240,147,251,0.3) !important;
            animation: celebrate 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.2rem;
            margin: 1.2rem 0;
        }

        .stat {
            text-align: center;
            padding: 1.2rem;
            background: linear-gradient(135deg, rgba(255,255,255,0.7), rgba(255,255,255,0.4));
            border-radius: 16px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent), #00a085);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.3rem;
        }

        #log {
            background: rgba(0,0,0,0.05);
            padding: 1rem;
            height: 140px;
            border-radius: 16px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
            overflow-y: auto;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
        }

        #log::-webkit-scrollbar {
            width: 8px;
        }

        #log::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
        }

        #log::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 10px;
        }

        .last3 { display: flex; flex-direction: column; gap: 0.8rem; }
        .last3-item {
            text-align: center;
            font-size: 2.3rem;
            font-weight: 900;
            padding: 1.2rem;
            border-radius: 18px;
            background: linear-gradient(135deg, var(--accent), #00a085);
            color: white;
            box-shadow: 0 8px 25px rgba(0,184,148,0.4);
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* THEMES */
        [data-theme="light"] {
            --bg-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --drawn-bg: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --text-primary: #2d3436;
            --accent: #00b894;
            --neon-glow: 0 0 25px #00b894;
        }

        [data-theme="dark"] {
            --bg-primary: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            --card-bg: rgba(25,25,35,0.95);
            --drawn-bg: linear-gradient(135deg, #ff6b7a, #ffa726);
            --text-primary: #e8e8e8;
            --accent: #4fc3f7;
            --neon-glow: 0 0 25px #4fc3f7;
        }

        [data-theme="neon"] {
            --bg-primary: linear-gradient(135deg, #ff00ff 0%, #00ffff 50%, #00ff00 100%);
            --card-bg: rgba(10,10,20,0.95);
            --drawn-bg: linear-gradient(135deg, #ffff00, #ff6600);
            --text-primary: #00ff00;
            --accent: #ff00ff;
            --neon-glow: 0 0 25px #ff00ff;
        }

        [data-theme="gold"] {
            --bg-primary: linear-gradient(135deg, #ffd700 0%, #ff8c00 50%, #daa520 100%);
            --card-bg: rgba(255,255,240,0.95);
            --drawn-bg: linear-gradient(135deg, #ff4500, #ff1493);
            --text-primary: #8b4513;
            --accent: #b8860b;
            --neon-glow: 0 0 25px #ffd700;
        }

        [data-theme="ocean"] {
            --bg-primary: linear-gradient(135deg, #0c2e4a 0%, #1a5c7a 50%, #2d8ab3 100%);
            --card-bg: rgba(20,40,60,0.95);
            --drawn-bg: linear-gradient(135deg, #00ced1, #20b2aa);
            --text-primary: #e0f7fa;
            --accent: #48d1cc;
            --neon-glow: 0 0 25px #00ced1;
        }

        [data-theme="fire"] {
            --bg-primary: linear-gradient(135deg, #ff4500 0%, #ff6347 50%, #ff1493 100%);
            --card-bg: rgba(50,20,10,0.95);
            --drawn-bg: linear-gradient(135deg, #ffff00, #ffa500);
            --text-primary: #fff;
            --accent: #ff4500;
            --neon-glow: 0 0 25px #ff4500;
        }

        .repeat-display {
            background: linear-gradient(135deg, var(--accent), #00a085);
            color: white;
            padding: 0.8rem;
            border-radius: 12px;
            text-align: center;
            font-weight: 700;
            font-size: 1.1rem;
            margin-top: 0.5rem;
            box-shadow: 0 4px 15px rgba(0,184,148,0.3);
        }
    </style>
</head>
<body data-theme="light">
    <header>üé≤ TAMBOLA‚ú®</header>

    <div class="layout">
        <!-- LEFT: Main Controls -->
        <div class="sidebar">
            <div class="card">
                <div id="latest">‚Äî</div>
            </div>
            
            <div class="card">
                <button class="btn" onclick="drawNumber()">üé≤ NEXT NUMBER</button>
                <button class="btn danger" onclick="resetGame()">üîÑ NEW GAME</button>
            </div>
            
            <div class="card">
                <div class="stats">
                    <div class="stat">
                        <div class="stat-number" id="drawnCount">0</div>
                        <div>DRAWN</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number" id="remainingCount">90</div>
                        <div>REMAINING</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div id="log"></div>
            </div>
        </div>

        <!-- CENTER: Stunning Grid -->
        <div class="card grid-card">
            <div id="grid"></div>
        </div>

        <!-- RIGHT: Elegant Controls -->
        <div class="sidebar">
            <div class="card">
                <label>üé® THEME</label>
                <select id="themeSelect" onchange="changeTheme(this.value)">
                    <option value="light">Light ‚ú®</option>
                    <option value="dark">Dark üåô</option>
                    <option value="neon">Neon üíú</option>
                    <option value="gold">Gold üëë</option>
                    <option value="ocean">Ocean üåä</option>
                    <option value="fire">Fire üî•</option>
                </select>
            </div>
            
            <div class="card">
                <label>üîä REPEAT TIMES</label>
                <input type="number" id="repeatCount" min="1" max="10" value="3" onchange="updateRepeatCount(this.value)">
                <div id="repeatDisplay" class="repeat-display">3 TIMES</div>
            </div>
            
            <div class="card">
                <label>üîä VOICE CALL</label>
                <div style="margin-bottom: 0.8rem;">
                    <button class="btn" id="voiceToggle" onclick="toggleVoice()" style="font-size:0.95rem;padding:0.8rem;">üîá OFF</button>
                </div>
                <input type="range" id="volumeRange" min="0" max="1" value="0.8" step="0.1" onchange="updateVolume(this.value)">
                <select id="voiceList" onchange="selectVoice(this.value)" style="margin-top:0.6rem;"></select>
            </div>
            
            <div class="card">
                <label>üèÜ LAST 3</label>
                <div class="last3" id="last3"></div>
            </div>
        </div>
    </div>

    <script>
        // üéØ STATE MANAGEMENT
        let numbers = [];
        let drawnNumbers = [];
        let voicesList = [];
        let voiceActive = false;
        let currentVolume = 0.8;
        let currentVoice = -1;
        let repeatCount = 3;

        // üöÄ Initialize
        function initTambola() {
            resetNumbers();
            buildGrid();
            updateAllDisplays();
            loadPreferences();
            initVoiceSystem();
            updateRepeatDisplay();
        }

        // üîä FIXED VOICE SYSTEM
       function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                document.getElementById('voiceInfo').textContent = 'SpeechSynthesis not supported';
                return;
            }
        
            // üÜï UNIVERSAL VOICE PRIORITY (works on Chrome/Safari/Edge/Firefox)
            const universalVoices = [
                // English US (most reliable across browsers)
                { nameMatch: 'Zira', lang: 'en-US' },
                { nameMatch: 'Microsoft', lang: 'en-US' },
                { nameMatch: 'Google US English', lang: 'en-US' },
                { nameMatch: 'David', lang: 'en-US' },
                
                // English UK (universal fallback)
                { nameMatch: 'Samantha', lang: 'en-GB' },
                { nameMatch: 'Serena', lang: 'en-GB' },
                { nameMatch: 'Daniel', lang: 'en-GB' },
                
                // Fallback: Any en-US/en-GB
                { langFallback: 'en-US' },
                { langFallback: 'en-GB' }
            ];
        
            function populateVoices() {
                voicesList = speechSynthesis.getVoices();
                const dropdown = document.getElementById('voiceList');
                dropdown.innerHTML = '<option value="-1">üé§ Auto (Universal)</option>';
                
                if (voicesList.length === 0) {
                    document.getElementById('voiceInfo').textContent = 'No voices detected';
                    return;
                }
        
                console.log(`üé§ Found ${voicesList.length} voices, prioritizing universal:`);
        
                let universalCount = 0;
                voicesList.forEach((voice, index) => {
                    // Check if universal
                    const isUniversal = universalVoices.some(uv => 
                        (uv.nameMatch && voice.name.includes(uv.nameMatch)) ||
                        (uv.langFallback && voice.lang === uv.langFallback)
                    );
                    
                    if (isUniversal) {
                        const option = document.createElement('option');
                        option.value = index;
                        option.textContent = `‚≠ê ${voice.name} (${voice.lang})`;
                        dropdown.appendChild(option);
                        universalCount++;
                        console.log(`  ‚≠ê ${index}: "${voice.name}" (${voice.lang})`);
                    }
                });
        
                // Add remaining English voices if needed
                if (universalCount < 10) {
                    voicesList.filter(voice => 
                        voice.lang.startsWith('en-') && 
                        !Array.from(dropdown.options).some(opt => opt.text.includes(voice.name))
                    ).slice(0, 10).forEach((voice, i) => {
                        const option = document.createElement('option');
                        option.value = voicesList.indexOf(voice);
                        option.textContent = `  ${voice.name} (${voice.lang})`;
                        dropdown.appendChild(option);
                    });
                }
        
                document.getElementById('voiceInfo').textContent = 
                    `‚≠ê ${universalCount} universal voices (${voicesList.length} total)`;
        
                // Auto-select first universal voice
                const firstUniversal = dropdown.querySelector('option[style*="‚≠ê"]');
                if (firstUniversal) {
                    dropdown.value = firstUniversal.value;
                    currentVoice = parseInt(firstUniversal.value);
                }
            }
        
            populateVoices();
            speechSynthesis.onvoiceschanged = populateVoices;
        }


        // üé§ Voice selection handler
        function selectVoice(voiceIndex) {
            currentVoice = parseInt(voiceIndex);
            localStorage.setItem('tambolaVoice', currentVoice);
            console.log(`Selected voice index: ${currentVoice}, Name: ${voicesList[currentVoice]?.name || 'Default'}`);
        }

        function resetNumbers() {
            numbers = Array.from({length: 90}, (_, i) => i + 1);
            drawnNumbers = [];
        }

        function buildGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            
            for (let i = 1; i <= 90; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.id = `cell-${i}`;
                cell.textContent = i;
                cell.title = `Click to call ${i}`;
                cell.onclick = () => calloutNumber(i);
                grid.appendChild(cell);
            }
        }

        function drawNumber() {
            if (numbers.length === 0) {
                showCelebration('üéâ GAME COMPLETE!');
                return;
            }
            
            const randomIdx = Math.floor(Math.random() * numbers.length);
            const number = numbers.splice(randomIdx, 1)[0];
            drawnNumbers.push(number);
            
            const cell = document.getElementById(`cell-${number}`);
            if (cell) {
                cell.style.animation = 'none';
                setTimeout(() => cell.style.animation = 'celebrate 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55)', 10);
                cell.classList.add('drawn');
            }
            
            updateAllDisplays();
            addLogEntry(number);
            
            if (voiceActive) {
                calloutNumber(number);
            } else {
                showCelebration(number);
            }
        }

        function updateRepeatCount(value) {
            repeatCount = parseInt(value);
            updateRepeatDisplay();
            savePreferences();
        }

        function updateRepeatDisplay() {
            const display = document.getElementById('repeatDisplay');
            display.textContent = `${repeatCount} TIME${repeatCount > 1 ? 'S' : ''}`;
        }

        // üó£Ô∏è FIXED VOICE CALL OUT
       function calloutNumber(n) {
            if (!voiceActive || !('speechSynthesis' in window)) { 
                showCelebration(n); 
                return; 
            }
            
            // Number-to-word mapping (English words for clarity)
            const words = {
                0: 'zero', 1: 'one', 2: 'two', 3: 'three', 4: 'four', 5: 'five',
                6: 'six', 7: 'seven', 8: 'eight', 9: 'nine', 10: 'ten', 11: 'eleven',
                12: 'twelve', 13: 'thirteen', 14: 'fourteen', 15: 'fifteen', 16: 'sixteen',
                17: 'seventeen', 18: 'eighteen', 19: 'nineteen', 20: 'twenty',
                30: 'thirty', 40: 'forty', 50: 'fifty', 60: 'sixty', 70: 'seventy',
                80: 'eighty', 90: 'ninety'
            };
            
            function numberToWords(num) {
                if (words[num] !== undefined) return words[num];
                if (num < 20) return words[num];
                const tens = Math.floor(num / 10) * 10;
                const ones = num % 10;
                if (ones === 0) return words[tens];
                return words[tens] + ' ' + words[ones];
            }
            
            let callText;
            if (n <= 9) {
                callText = `Single number ${numberToWords(n)}`;
            } else {
                const digits = n.toString().split('').map(Number);
                const digitWords = digits.map(d => numberToWords(d)).join(', ');
                callText = `${digitWords} ${numberToWords(n)}`;
            }
            
            speechSynthesis.cancel();
            for (let i = 0; i < repeatCount; i++) {
                setTimeout(() => {
                    const utterance = new SpeechSynthesisUtterance(callText);
                    utterance.volume = currentVolume;
                    utterance.rate = i === 0 ? 0.7 : 0.9;
                    if (currentVoice >= 0 && currentVoice < voicesList.length) {
                        utterance.voice = voicesList[currentVoice];
                    }
                    speechSynthesis.speak(utterance);
                }, i * 1300);
            }
            showCelebration(n);
        }

            
            // Clear any pending speech
            speechSynthesis.cancel();
            
            for (let i = 0; i < repeatCount; i++) {
                setTimeout(() => {
                    const utterance = new SpeechSynthesisUtterance(`Number ${n}`);
                    utterance.volume = currentVolume;
                    utterance.rate = i === 0 ? 0.7 : 0.9;
                    
                    // ‚úÖ FIXED: Proper voice assignment with validation
                    if (currentVoice >= 0 && currentVoice < voicesList.length) {
                        const selectedVoice = voicesList[currentVoice];
                        utterance.voice = selectedVoice;
                        console.log(`Using voice: ${selectedVoice.name}`);
                    }
                    
                    speechSynthesis.speak(utterance);
                }, i * 1300);
            }
            
            showCelebration(n);
        }

        function showCelebration(content) {
            const latest = document.getElementById('latest');
            latest.textContent = content;
            latest.style.animation = 'heartbeat 0.6s ease-in-out 3';
            
            setTimeout(() => {
                latest.style.animation = 'heartbeat 1.5s ease-in-out infinite';
            }, 2000);
        }

        function updateAllDisplays() {
            document.getElementById('latest').textContent = drawnNumbers[drawnNumbers.length - 1] || '‚Äî';
            document.getElementById('drawnCount').textContent = drawnNumbers.length;
            document.getElementById('remainingCount').textContent = numbers.length;
            updateLastThreeDisplay();
        }

        function updateLastThreeDisplay() {
            const lastThree = drawnNumbers.slice(-3).reverse();
            const container = document.getElementById('last3');
            container.innerHTML = lastThree.map(num => 
                `<div class="last3-item">${num || '‚Äî'}</div>`
            ).join('');
        }

        function addLogEntry(num) {
            const now = new Date().toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});
            const logDiv = document.getElementById('log');
            logDiv.innerHTML = `<div style="animation: slideIn 0.3s ease-out;">${now} üé≤ ${num}</div>` + logDiv.innerHTML;
            logDiv.scrollTop = 0;
        }

        function resetGame() {
            if (confirm('üéÆ Start new game?')) {
                initTambola();
                addLogEntry('üîÑ NEW GAME');
            }
        }

        function toggleVoice() {
            voiceActive = !voiceActive;
            const btn = document.getElementById('voiceToggle');
            btn.innerHTML = voiceActive ? `üîä ON <span style="font-size:0.8em;">(${repeatCount}x)</span>` : 'üîá OFF';
            btn.style.background = voiceActive ? 
                'linear-gradient(135deg, #00b894, #00cec9)' : 
                'linear-gradient(135deg, #636e72, #2d3436)';
        }

        function updateVolume(value) {
            currentVolume = parseFloat(value);
        }

        function changeTheme(theme) {
            document.body.dataset.theme = theme;
            savePreferences();
        }

        function loadPreferences() {
            const prefs = JSON.parse(localStorage.getItem('tambolaPrefs') || '{}');
            const savedTheme = prefs.theme || 'light';
            repeatCount = prefs.repeat || 3;
            
            document.getElementById('themeSelect').value = savedTheme;
            document.getElementById('repeatCount').value = repeatCount;
            changeTheme(savedTheme);
            updateRepeatDisplay();
        }

        function savePreferences() {
            const prefs = {
                theme: document.body.dataset.theme,
                repeat: repeatCount
            };
            localStorage.setItem('tambolaPrefs', JSON.stringify(prefs));
        }

        // üåê Global listeners
        document.addEventListener('DOMContentLoaded', () => {
            initTambola();
        });

        document.addEventListener('keydown', e => {
            if (e.code === 'Space') {
                e.preventDefault();
                drawNumber();
            }
        });
    </script>
</body>
</html>

